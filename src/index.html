<!doctype html>
<html lang="en" dir="ltr">
  <head>
    <title>CanvasContextRenderingContext2d.filter partial polyfill</title>
    <link rel="stylesheet" href="index.css" />
    <script>
      // reload page on file change
      if (typeof EventSource !== 'undefined') {
        new EventSource('/esbuild').addEventListener('change', () =>
          location.reload(),
        );
      }
    </script>
    <script src="polyfill.js"></script>
  </head>
  <body>
    <main>
      <article id="filters">
        <section>
          <canvas class="none" width="100" height="134"></canvas>
          <pre>none</pre>
        </section>

        <section>
          <canvas class="blur" width="100" height="134"></canvas>
          <pre>blur(6px)</pre>
        </section>

        <section>
          <canvas class="brightness" width="100" height="134"></canvas>
          <pre>brightness(2)</pre>
        </section>

        <section>
          <canvas class="contrast" width="100" height="134"></canvas>
          <pre>contrast(250%)</pre>
        </section>

        <section>
          <canvas class="drop-shadow" width="100" height="134"></canvas>
          <pre>drop-shadow(3px 3px 5px red)</pre>
        </section>

        <section>
          <canvas class="grayscale" width="100" height="134"></canvas>
          <pre>grayscale(50%)</pre>
        </section>

        <section>
          <canvas class="hue-rotate" width="100" height="134"></canvas>
          <pre>hue-rotate(180deg)</pre>
        </section>

        <section>
          <canvas class="invert" width="100" height="134"></canvas>
          <pre>invert(.9)</pre>
        </section>

        <section>
          <canvas class="opacity" width="100" height="134"></canvas>
          <pre>opacity(.5)</pre>
        </section>

        <section>
          <canvas class="saturate" width="100" height="134"></canvas>
          <pre>saturate(5)</pre>
        </section>

        <section>
          <canvas class="sepia" width="100" height="134"></canvas>
          <pre>sepia(100%)</pre>
        </section>

        <script>
          document.querySelectorAll('#filters section').forEach(section => {
            const ctx = section.querySelector('canvas').getContext('2d');
            ctx.filter = section.querySelector('pre').textContent;

            const img = new Image();
            img.onload = () => ctx.drawImage(img, 0, 0);
            img.src = 'mocks/mock-1.jpg';
          });
        </script>
      </article>

      <article>
        <section>
          <canvas class="testOrigin" width="100" height="134"></canvas>
          <script>
            const ctxTestOrigin = document
              .querySelector('canvas.testOrigin')
              .getContext('2d');
            const grdntTestOrigin = ctxTestOrigin.createLinearGradient(
              0,
              0,
              100,
              134,
            );
            grdntTestOrigin.addColorStop(0.15, 'cyan');
            grdntTestOrigin.addColorStop(0.5, 'magenta');
            grdntTestOrigin.addColorStop(0.85, 'yellow');
            ctxTestOrigin.fillStyle = grdntTestOrigin;
            ctxTestOrigin.fillRect(0, 0, 100, 134);
          </script>
        </section>

        <section>
          <canvas class="test" width="100" height="134"></canvas>
          <script>
            const ctxTest = document
              .querySelector('canvas.test')
              .getContext('2d');
            const grdntTest = ctxTestOrigin.createLinearGradient(
              0,
              0,
              100,
              134,
            );
            ctxTest.filter = 'invert(1)';
            grdntTest.addColorStop(0.15, 'cyan');
            grdntTest.addColorStop(0.5, 'magenta');
            grdntTest.addColorStop(0.85, 'yellow');
            ctxTest.fillStyle = grdntTest;
            ctxTest.fillRect(0, 0, 100, 134);
          </script>
        </section>

        <section>
          <canvas class="mixed" width="100" height="134"></canvas>
          <script>
            const ctxMixed = document
              .querySelector('canvas.mixed')
              .getContext('2d');

            // 1st step: single filter - blurred text
            ctxMixed.filter = 'blur(4px) drop-shadow(2px 2px 10px red)';
            ctxMixed.font = '16px serif';
            ctxMixed.fillText('Hello world', 10, 20);

            // 2nd step: multiple filters - inverted, opaque and rotated rectangle
            ctxMixed.filter =
              'invert(.75) opacity(.5) drop-shadow(4px 4px 4px red)';
            ctxMixed.fillStyle = '#f00';
            ctxMixed.translate(50, 25);
            ctxMixed.rotate((45 * Math.PI) / 180);
            ctxMixed.fillRect(-25, -15, 50, 50);
          </script>
        </section>

        <section>
          <canvas class="comp" width="100" height="134"></canvas>
          <script>
            const ctxComp = document
              .querySelector('canvas.comp')
              .getContext('2d');
            ctxComp.globalCompositeOperation = 'xor';
            ctxComp.filter = 'invert(.75) blur(6px)';
            ctxComp.fillStyle = 'blue';
            ctxComp.fillRect(10, 10, 60, 60);
            ctxComp.fillStyle = 'red';
            ctxComp.fillRect(30, 30, 60, 60);
          </script>
        </section>

        <section>
          <canvas class="clear" width="100" height="134"></canvas>
          <script>
            const ctxClear = document
              .querySelector('canvas.clear')
              .getContext('2d');
            ctxClear.globalCompositeOperation = 'xor';
            ctxClear.filter = 'blur(5px)';
            ctxClear.fillStyle = 'red';
            ctxClear.fillRect(10, 10, 80, 114);
            ctxClear.clearRect(25, 25, 50, 84);
          </script>
        </section>
      </article>

      <article class="debug">
        <canvas height="200" width="300"></canvas>
        <section id="clones"></section>
        <script>
          const ctxDebug = document
            .querySelector('.debug canvas')
            .getContext('2d');

          ctxDebug.filter = 'blur(5px)';
          ctxDebug.fillStyle = 'red';
          ctxDebug.fillRect(50, 50, 200, 100);

          ctxDebug.filter = 'invert(1)';
          ctxDebug.fillText('Hello World', 30, 30);

          ctxDebug.filter = 'invert(1) opacity(.25)';
          ctxDebug.strokeStyle = 'black';
          ctxDebug.beginPath();
          ctxDebug.moveTo(20, 20);
          ctxDebug.lineTo(20, 100);
          ctxDebug.lineTo(70, 100);
          ctxDebug.lineWidth = 10;
          ctxDebug.lineCap = 'round';
          ctxDebug.lineJoin = 'round';
          ctxDebug.stroke();

          ctxDebug.strokeStyle = 'yellow';
          //ctxDebug.beginPath();
          //ctxDebug.moveTo(70, 100);
          ctxDebug.lineTo(20, 20);
          ctxDebug.stroke();
        </script>
      </article>
    </main>
  </body>
</html>
